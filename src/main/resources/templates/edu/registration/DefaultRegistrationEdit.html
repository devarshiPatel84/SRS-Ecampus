<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Student Registration Edit</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background-image: url('/login_38.gif');
            background-repeat: repeat-y;
            background-position: left top;
            background-attachment: fixed;
            background-color: white;
        }
        body::after {
            content: "";
            position: fixed;
            top: 0;
            right: 0;
            width: 20px;
            height: 100%;
            background-image: url('/login_38.gif');
            background-repeat: repeat-y;
            background-position: right top;
            background-attachment: fixed;
            z-index: -1;
        }
        .top-bar {
            background-color: #003366;
            padding: 10px;
            color: white;
        }
        .sidemenu {
            background-image: url('/login_38.gif');
            background-repeat: repeat-y;
            width: 15px;
        }
        .content {
            padding: 30px;
        }
        .footer {
            font-size: 12px;
            color: #333;
            text-align: center;
            padding: 10px;
            border-top: 1px solid #6699cc;
        }
        .table-container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h2, h3 {
            text-align: center;
            margin-bottom: 25px;
        }
    </style>
</head>
<body>
<table style="width:100%;">
<tr>
<td colspan="3" class="top-bar">
    <span style="font-size: 24px; font-weight: bold;">DA-IICT</span>
    <span style="font-size: 16px;">&nbsp;Dhirubhai Ambani Institute of Information & Communication Technology</span>
</td>
</tr>
<tr>
<td class="sidemenu"></td>
<td class="content">
    <div class="table-container">
        <h2>Registration Form</h2>
        <table class="table table-bordered">
            <tr><td><strong>Name</strong></td><td th:text="${studentbean.name}">Student Name</td>
                <td><strong>Program</strong></td><td th:text="${studentbean.programName}">Program Name</td></tr>
            <tr><td><strong>Student ID</strong></td><td th:text="${studentbean.id}">ID</td>
                <td><strong>Batch</strong></td><td th:text="${studentbean.batchId}">Batch</td></tr>
            <tr><td><strong>Semester</strong></td><td th:text="${semesterBean.name}">Semester</td>
                <td><strong>Date</strong></td>
                <td th:text="${alreadyRegistered} ? ${#temporals.format(stdregbean.registrationDate, 'yyyy-MM-dd')} : ${#temporals.format(T(java.time.LocalDate).now(), 'yyyy-MM-dd')}">Date</td></tr>
        </table>

        <!-- Already Registered Section -->
        <div th:if="${alreadyRegistered}">
            <h3>Courses Already Registered</h3>
            <table class="table table-bordered table-striped">
                <thead><tr><th>Code</th><th>Title</th><th>Credits</th><th>Status</th></tr></thead>
                <tbody>
                    <tr th:each="course : ${registeredCourses}">
                        <td th:text="${course.courseCode}">CS401</td>
                        <td th:text="${course.courseName}">Course Name</td>
                        <td th:text="${course.credits}">3.0</td>
                        <td th:text="${course.status}">ACTIVE</td>
                    </tr>
                </tbody>
            </table>

            <h3>Other Courses</h3>
            <table class="table table-bordered">
                <thead><tr><th>Sr. No.</th><th>Course</th><th>Register</th></tr></thead>
                <tbody><tr><td>1</td><td></td><td></td></tr></tbody>
            </table>

            <h3>Grade Improvement Courses</h3>
            <table class="table table-bordered">
                <thead><tr><th>Sr. No.</th><th>Course</th><th>Register</th></tr></thead>
                <tbody><tr><td>1</td><td></td><td></td></tr></tbody>
            </table>

            <h3>Backlog Courses</h3>
            <table class="table table-bordered">
                <thead><tr><th>Sr. No.</th><th>Course</th><th>Register</th></tr></thead>
                <tbody><tr><td>1</td><td></td><td></td></tr></tbody>
            </table>

            <h3>Audit Courses</h3>
            <table class="table table-bordered">
                <thead><tr><th>Sr. No.</th><th>Course</th><th>Register</th></tr></thead>
                <tbody><tr><td>1</td><td></td><td></td></tr></tbody>
            </table>

            <h3>Workflow</h3>
            <table class="table table-bordered">
                <thead><tr><th>Responder</th><th>Response</th><th>Date</th><th>Remark</th></tr></thead>
                <tbody>
                    <tr><td>UG Convenor</td><td>Approved</td><td>--/--/----</td><td>All clear</td></tr>
                    <tr><td th:text="${studentbean.name}">Student</td><td>Submitted</td><td>--/--/----</td><td></td></tr>
                </tbody>
            </table>

            <form th:action="@{/studentRegistrations}" method="get" class="text-center mt-4">
                <input type="hidden" name="stdid" th:value="${studentbean.id}"/>
                <button type="submit" class="btn btn-secondary">Back</button>
            </form>
        </div>

        <!-- New Registration Section -->
        <div th:unless="${alreadyRegistered}">
            <h3>Select Courses</h3>
            <form method="post" id="registrationForm">
                <table class="table table-bordered">
                    <thead><tr><th>Sr. No.</th><th>Course</th><th>Register</th></tr></thead>
                    <tbody id="courseSelectionBody"></tbody>
                </table>

                <div class="mb-3">
                    <label class="form-label">Remarks</label>
                    <textarea name="remarks" class="form-control" rows="3"></textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label">Select Course Authority:</label>
                    <select name="authority" class="form-select">
                        <option value="UG Convenor">UG Convenor</option>
                        <!-- <option value="Registrar">Registrar</option> -->
                    </select>
                </div>

                <div class="text-center">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
            </form>

            <form th:action="@{/studentRegistrations}" method="get" class="text-center mt-3">
                <input type="hidden" name="stdid" th:value="${studentbean.id}"/>
                <button type="submit" class="btn btn-secondary">Back</button>
            </form>
        </div>
    </div>
</td>
<td class="sidemenu"></td>
</tr>
<tr><td class="sidemenu"></td>
<td class="footer" colspan="1">&copy; 2002 DA-IICT, Gandhinagar, Gujarat, India.</td>
<td class="sidemenu"></td></tr>
</table>

<!-- JS: Dynamic Dropdown -->
<script th:inline="javascript">
/*<![CDATA[*/
    const availableCourses = [[${availableCourses}]];
    const tbody = document.getElementById('courseSelectionBody');
    const maxSelections = availableCourses.length;
    const selectedCourses = new Array(maxSelections).fill(null);

    function renderDropdowns() {
        tbody.innerHTML = '';
        for (let i = 0; i < maxSelections; i++) {
            const row = document.createElement('tr');

            const srNoTd = document.createElement('td');
            srNoTd.textContent = i + 1;

            const courseTd = document.createElement('td');
            const select = document.createElement('select');
            select.className = 'form-select';
            select.name = `course_${i}`;
            select.dataset.index = i;

            const placeholder = document.createElement('option');
            placeholder.text = 'Select course';
            placeholder.value = '';
            select.appendChild(placeholder);

            const used = selectedCourses.filter((c, idx) => idx !== i && c !== null);
            const options = availableCourses.filter(c => !used.includes(c));

            for (const course of options) {
                const option = document.createElement('option');
                option.value = course.courseCode;
                option.text = `${course.courseName} (${course.courseCode})`;
                if (selectedCourses[i] && selectedCourses[i].courseCode === course.courseCode) {
                    option.selected = true;
                }
                select.appendChild(option);
            }

            select.addEventListener('change', (e) => {
                const idx = parseInt(e.target.dataset.index);
                const code = e.target.value;
                const course = availableCourses.find(c => c.courseCode === code);
                selectedCourses[idx] = course;
                renderDropdowns();
            });

            courseTd.appendChild(select);

            const checkTd = document.createElement('td');
            const check = document.createElement('input');
            check.type = 'checkbox';
            check.className = 'form-check-input';
            check.name = `registerCheck_${i}`;
            check.checked = !!selectedCourses[i];
            checkTd.appendChild(check);

            row.appendChild(srNoTd);
            row.appendChild(courseTd);
            row.appendChild(checkTd);

            tbody.appendChild(row);
        }
    }

    document.addEventListener('DOMContentLoaded', renderDropdowns);
/*]]>*/
</script>
</body>
</html>
